Issues/Errors Detected
-----------------------
Total: 15, 14 new, 1 existing (enhanced with reproducibility details which were not previously provided)
Severity: 7 Low, 6 Medium, 2 High
Types: 12 Crashes, 2 Accuracy Errors, 1 Redundancy/Warning
Issues Acknowledgement: The optimizer developers have acknowledged our contribution in total.
-----------------------

1) The "lift_lexical_references" pass should not lead in an invalid model, but extract metadata instead.
Type: Crash (Invalid Model)
Status: New
Description: The pass removes the references arbitrarily, without checking if they are used in the model (e.g., on the initializer)
Pass(es): lift_lexical_references
Issue URL: https://github.com/onnx/optimizer/issues/156
Severity: Low (secondary pass)

2) The "split_init" pass results in invalid models (#1).
Type: Crash (Invalid Model)
Status: New
Description: The split_init pass gives this error: ""split_init": "IndexError('list index (0) out of range')""
Pass(es): split_init
Severity: Low (secondary pass)
Issue URL: https://github.com/onnx/optimizer/issues/157

3) The "split_init and split_predict" passes result in invalid models (#2).
Type: Crash (Optimizer)
Status: New
Description: The split_init and split_predict passes give this error: "C.check_model_path(\\nonnx.onnx_cpp2py_export.checker.ValidationError: Field \\'type\\' of \\'value_info\\' is required but missing.\\n'"
Pass(es): split_init, split_predict
Severity: Low (secondary passes)
Issue URL: https://github.com/onnx/optimizer/issues/157

4) The "split_predict" pass results in invalid models (#3).
Type: Crash (Invalid Model)
Status: New
Description: The split_predict pass gives this error: "Bad node spec for node. Name: TFNodes/yolo_evaluation_layer_1/arange_1__246_loop OpType: Loop"
Pass(es): split_init, split_predict
Severity: Low (secondary pass)
Issue URL: https://github.com/onnx/optimizer/issues/157

5) The "split_predict" pass results in invalid models (#4).
Type: Crash (Invalid Model)
Status: New
Description: The split_predict pass gives this error: "Required inputs "..." are missing from input feed (['image']))"
Pass(es): split_predict
Severity: Low (secondary pass)
Issue URL: https://github.com/onnx/optimizer/issues/157

6) The "split_predict" pass crashes with ShapeInferenceError (#5).
Type: Crash (Invalid Model)
Status: New
Description: The "split_predict" pass gives [ONNXRuntimeError] : 1 : FAIL : Node (Resize_140) Op (Resize) [ShapeInferenceError]
Pass(es): split_predict
Severity: Low (secondary pass)
Issue URL: https://github.com/onnx/optimizer/issues/157 (comment)

7) Pass "eliminate_shape_gather" results in a dimension size error.
Type: Crash (Optimizer)
Status: New
Description: While running "eliminate_shape_gather" pass for model R-CNN R-50-FPN it gives a dimension size error.
Pass(es): eliminate_shape_gather
Severity: Medium (primary pass, optimizer crash)
Issue URL: https://github.com/onnx/optimizer/issues/158

8) Models of opset 7,8 and 9 present slightly different results when optimized.
Type: Accuracy
Status: New
Description: When optimizing a number models with opset=7, 8, 9. These models have ONNX v3 format, but when optimized, although the structure remains the same, the format is upgraded implicitly to ONNX v4. This affects model correctness, to a small, but non-negligible extent, affecting top-5 and top-10 labels for classification models while the top-1 label remained accurate. This does not happen for models of higher opset (10 and above).
Pass(es): all
Severity: High (all passes, non-crashing effect, difficult to detect)
Issue URL: https://github.com/onnx/optimizer/issues/159

9) Pass "rewrite_input_dtype" gives an error on GPT-2.
Type: Crash (Optimizer)
Status: New
Description: While applying the rewrite_input_dtype pass, I encountered the C.check_model_path(onnx.onnx_cpp2py_export.checker.ValidationError)
Pass(es): rewrite_input_dtype
Severity: Medium (primary pass, optimizer crash)
Issue URL: https://github.com/onnx/optimizer/issues/170

10) Pass "eliminate_consecutive_idempotent_ops" succeeds but model gives an incompatible shape error upon run.
Type: Crash (Model)
Status: New
Description: While optimizing a number of Mask and Faster R-CNN models on opset=12 from the ONNX Model Hub, the optimizer generated the models, but we encountered the following error when applying the eliminate_consecutive_idempotent_ops pass: "FAIL : Node (<NODE>) Op (Reshape) [ShapeInferenceError] Dimension could not be inferred: incompatible shapes".
Pass(es): eliminate_consecutive_idempotent_ops
Severity: Medium (primary pass, model crash)
Issue URL: https://github.com/onnx/optimizer/issues/171

11) Pass "eliminate_duplicate_initializer" fails on R-CNN model.
Type: Crash (Optimizer)
Status: New
Description: While using the pass eliminate_duplicate_initializer to optimize the model Faster R-CNN R-50-FPN-qdq of opset=12 from ONNX Model Hub, I encounter the following error: "Assertion "outputs_[i]->uses().empty()" failed.".
Pass(es): eliminate_duplicate_initializer
Severity: Medium (primary pass, optimizer crash)
Issue URL: https://github.com/onnx/optimizer/issues/172

12) Pass "fuse_bn_into_conv" introduces duplicate initializer.
Type: Crash (Optimizer)
Status: New
Description: While fetching RetinaNet of opset=9 from ONNX Model Hub and optimizing it using fuse_bn_into_conv pass, I encounter the following error, related to the model initializer: "onnx.onnx_cpp2py_export.checker.ValidationError: 1133 initializer name is not unique.".
Pass(es): fuse_bn_into_conv
Severity: Medium (primary pass, optimizer)
Issue URL: https://github.com/onnx/optimizer/issues/174

13) Redundant initializers introduced to the models using eliminate passes.
Type: Redundancy/Warning
Status: New
Description: The optimizer adds redundant initializer nodes to the models, in different passes (e.g., eliminate_shape_gather and eliminate_nop_reshape). Upon execution, they are removed and the models work, however the models get bloated this way and it would be nice to resolve this, as it has to do with eliminate passes which are part of the default optimization bundle.
Pass(es): eliminate_shape_gather, eliminate_op_reshape
Severity: Very Low (Warning)
Issue URL: https://github.com/onnx/optimizer/issues/176

14) Issue with BatchNormalization node dimensions on VGG and DUC_HDC models (opset=7)
Type: Crash (Optimizer)
Status: New
Description: When optimizing and running some VGG and ResNet DUC HDC models from ONNX Model Hub, I encountered an issue related to BatchNormalization nodes: "Status Message: Invalid input scale: NumDimensions() != 3".
Passes: all
Severity: Medium (all passes, optimizer)
Issue URL: https://github.com/onnx/optimizer/issues/177

15) Pass "fuse_bn_into_conv" results in problematic graph and affects results.
Type: Accuracy
Status: Existing (Enhanced, new info provided)
Description: When using fuse_bn_into_conv the optimizer causes a generation of redundant nodes which result in problematic model behavior.
Passes: fuse_bn_into_conv
Severity: High (primary pass, non-crashing error that affects model accuracy)
Issue URL: https://github.com/onnx/optimizer/issues/178

